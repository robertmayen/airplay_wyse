[Service]
# Treat semantic non-zero exits as success for converge oneshot
SuccessExitStatus=2 3 6 10 11
RemainAfterExit=no

# Allow converge to read sudoers.d for bootstrap validation
# This fixes the "Permission denied" error when checking bootstrap status
ReadOnlyPaths=/etc/sudoers.d

# Additional permissions for converge to function properly
# Based on runtime fixes that were needed for proper operation
PrivateDevices=no
ProtectSystem=no
ProtectHome=no
NoNewPrivileges=no

# Ensure converge can access necessary system directories
ReadWritePaths=/var/lib/airplay_wyse
ReadWritePaths=/run/airplay
ReadWritePaths=/tmp

# Allow network access for package operations and git operations
PrivateNetwork=no

# Environment variables for non-interactive operations
Environment=DEBIAN_FRONTEND=noninteractive
Environment=APT_LISTCHANGES_FRONTEND=none
Environment=NEEDRESTART_MODE=a
