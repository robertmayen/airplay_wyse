#!/usr/bin/env bash
set -euo pipefail

echo "=== System ==="
hostnamectl || true
systemctl --version || true

echo -e "\n=== Services (update, converge) ==="
for u in update.service converge.service; do
  echo "# $u"
  systemctl status --no-pager -l "$u" || true
done

echo -e "\n=== Sudoers glimpse ==="
sudo -n -v && echo "sudo nopass OK" || echo "sudo requires pw or disabled"
sudo -l 2>&1 | grep -E "NOPASSWD|may run" || true

echo -e "\n=== Exec bits ==="
find bin pkg -maxdepth 1 -type f -name "*.sh" -exec ls -l {} \;

echo -e "\n=== Deps ==="
for c in git gpg jq systemctl; do command -v "$c" || true; done

echo -e "\n=== Recent logs ==="
journalctl -u update -u converge -u converge-broker --since "1 hour ago" --no-pager || true
